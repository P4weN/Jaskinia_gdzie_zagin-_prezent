<!DOCTYPE html>
<html lang="pl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>Stara Jaskinia</title>
<link rel="stylesheet" href="style.css">
<link href="https://fonts.googleapis.com/css2?family=Pixelify+Sans:wght@400..700&display=swap" rel="stylesheet">
</head>
<body>

<!-- MENU -->
<div id="menu" class="screen">
    <h1 class="W">Witaj w jaskini zaginionych prezent贸w!</h1>
    <p>Kliknij przycisk <b>start</b> by zacz szuka!</p>
    <button onclick="pokazInstrukcje()">START</button>
</div>

<!-- INSTRUKCJA -->
<div id="instrukcja" class="screen" style="display:none;">
    <h1 class="W">Instrukcja</h1>
    <p>Twoim zadaniem jest odszyfrowanie zaginionego hasa.<br>Odszyfrowanie hasa polega na klikaniu w pojawiajce si .<br>Ka偶de zdobyte  to +10% w postpie.</p>
    <h2><b>UWAGA!</b></h2>
    <p>Gra wraz z postpem robi si szybsza. Powodzenia!</p>
    <button onclick="rozpocznijOdliczanie()">OK</button>
</div>

<!-- ODLICZANIE -->
<div id="countdown">3</div>

<!-- GRA -->
<div id="graArea">
    <div id="ui">
        <div class="uiText">Odszyfrowywanie hasa...</div>
        <div id="progressBar">
            <div id="progress"></div>
        </div>
        <div id="percentText">0%</div>
    </div>
</div>

<!-- BRAWO -->
<div id="brawo" class="screen" style="display:none;">
    <h1 class="W">BRAWO!</h1>
    <p>Udao ci si odszyfrowa haso.<br><b>Haso : </b>M贸j brat Pawe to sigma</p>
    <h2><b>Wpisz haso poni偶ej:</b></h2>
    <input type="text" id="hasloInput">
    <button onclick="sprawdzHaslo()">GOTOWY?</button>
</div>

<!-- PREZENT -->
<div id="prezentScreen" class="screen" style="display:none;">
    <div id="giftBox" class="gift" onclick="otworzPrezent()"></div>

    <div id="steamKeyBox" style="display:none; margin-top:20px;">
        <h2>A wic wszystkiego najlepszego staruchu!</h2>
        <h2>Tw贸j Steam Key(40z):</h2>
        <hr class="hr">
        <h1 id="steamKey">ABCD1-EFGH2-IJKL3</h1>
        <hr class="hr">
        <button onclick="kopiujKod()">KOPIUJ KOD</button>
    </div>
</div>

<audio id="clickSound" src="jump.wav"></audio>

<script>

/* ===== ZMIENNE ===== */
let progress = 0;
let lifetime = 1000;
let activePacket = null;

/* ===== MENU ===== */
function pokazInstrukcje(){
    menu.style.display = "none";
    instrukcja.style.display = "flex";
}

function rozpocznijOdliczanie(){
    instrukcja.style.display = "none";
    countdown();
}

/* ===== ODLICZANIE ===== */
function countdown(){
    const cd = countdownDiv;
    cd.style.display="flex";
    let liczba = 3;
    cd.innerText = liczba;

    let interval = setInterval(()=>{
        liczba--;
        cd.innerText = liczba;

        if(liczba===0){
            clearInterval(interval);
            cd.style.display="none";
            startGry();
        }
    },1000);
}

/* ===== START GRY ===== */
function startGry(){
    graArea.style.display="block";
    spawnPacket();
}

/* ===== OGIE NA CAYM EKRANIE ===== */
function spawnPacket(){

    if(progress >= 100){
        koniecGry();
        return;
    }

    if(activePacket){
        activePacket.remove();
        activePacket = null;
    }

    const packet = document.createElement("div");
    packet.className = "packet";
    packet.innerText = "";

    const screenWidth = window.innerWidth;
    const screenHeight = window.innerHeight;

    const x = Math.random() * (screenWidth - 80);
    const y = Math.random() * (screenHeight - 80);

    packet.style.left = x + "px";
    packet.style.top = y + "px";

    document.body.appendChild(packet);
    activePacket = packet;

    const timeout = setTimeout(spawnPacket, lifetime);

    packet.onclick = () => {
        clickSound.currentTime = 0;
        clickSound.play();

        clearTimeout(timeout);
        packet.remove();

        progress += 10;
        if(progress > 100) progress = 100;

        progressDiv.style.width = progress + "%";
        percentText.innerText = progress + "%";

        lifetime -= 10;

        spawnPacket();
    };
}

/* ===== KONIEC GRY ===== */
function koniecGry(){
    graArea.classList.add("shake");

    setTimeout(()=>{
        graArea.classList.remove("shake");
        graArea.style.display = "none";
        brawo.style.display = "flex";
    },2000);
}

/* ===== HASO ===== */
function sprawdzHaslo(){
    if(hasloInput.value.trim() === "M贸j brat Pawe to sigma"){
        brawo.style.display = "none";
        prezentScreen.style.display = "flex";
    } else {
        alert("殴le wpisane haso ");
    }
}

/* ===== PREZENT ===== */
function otworzPrezent(){
    giftBox.style.transition = "transform 0.6s";
    giftBox.style.transform = "rotate(720deg) scale(1.5)";

    setTimeout(()=>{
        giftBox.style.display = "none";
        steamKeyBox.style.display = "block";
    },700);
}

function kopiujKod(){
    navigator.clipboard.writeText(steamKey.innerText);
    alert("Skopiowano kod! ");
}

/* ===== SKRTY ===== */
const menu = document.getElementById("menu");
const instrukcja = document.getElementById("instrukcja");
const countdownDiv = document.getElementById("countdown");
const graArea = document.getElementById("graArea");
const progressDiv = document.getElementById("progress");
const percentText = document.getElementById("percentText");
const brawo = document.getElementById("brawo");
const hasloInput = document.getElementById("hasloInput");
const prezentScreen = document.getElementById("prezentScreen");
const giftBox = document.getElementById("giftBox");
const steamKeyBox = document.getElementById("steamKeyBox");
const steamKey = document.getElementById("steamKey");
const clickSound = document.getElementById("clickSound");

</script>

</body>
</html>
